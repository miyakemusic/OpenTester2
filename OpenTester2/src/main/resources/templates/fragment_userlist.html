<div>
	<div id="fragment_userlist_tableid"></div>
	<div id="fragment_userlist_message"></div>
	<button onclick="fragment_userlist_onClickNewUser();" th:text="#{label.user.newuser}"></button>
</div>
<script type="text/javascript" th:inline="javascript">
	$(function() {
		fragment_userlist_getlist();
	});
			
	function fragment_userlist_getlist() {
//					debugger;
		$.ajax({
		  url: '/admin/fragment_usertable',
		  type: 'GET',
		  dataType: "text",
		}).done((data, textStatus, jqXHR) => {
			$('#fragment_userlist_tableid').empty();
			$('#fragment_userlist_tableid').append(data);
			
			var onEdit = function(username) {
				fragment_userlist_onEdit(username);
			};
			
			var onDelete = function(username) {
				fragment_userlist_onDelete(username);
			};
			
			userTable.callback(onEdit, onDelete);
		}).fail((jqXHR, textStatus, errorThrown) => {
			//fragment_userinfo_showMessage(jqXHR.responseText);
		});			
	}
	
	function fragment_userlist_onClickNewUser() {
		largeDialog.callback(function(){
			fragment_userinfo_post('/api/admin/newuser', function(){
				fragment_userlist_getlist();
				largeDialog.hideDialog();
			});
		});
		$.ajax({
		  url: '/admin/fragment_newuserinfo',
		  type: 'GET',
		  dataType: "text",
		}).done((data, textStatus, jqXHR) => {
			largeDialog.showDialog(data);
		}).fail((jqXHR, textStatus, errorThrown) => {
			//fragment_userinfo_showMessage(jqXHR.responseText);
		});				
	}
			
	function fragment_userlist_onDelete(username) {
		$('#fragment_userlist_message').removeClass('alert alert-danger');
		$.ajax({
		  url: '/api/admin/user?username=' + username,
		  type: 'DELETE',
		  dataType: "json",
		}).done((data, textStatus, jqXHR) => {
			fragment_userlist_getlist();
		}).fail((jqXHR, textStatus, errorThrown) => {
			$('#fragment_userlist_message').empty();
			$('#fragment_userlist_message').addClass('alert alert-danger');
			$('#fragment_userlist_message').append('<label>' + jqXHR.responseText + '</label>');
		});				
	}
	
	function fragment_userlist_onEdit(username) {
		largeDialog.callback(function(){
			fragment_userinfo_post('/api/admin/user', function(){
				fragment_userlist_getlist();
				largeDialog.hideDialog();
			});
		});
		
		$.ajax({
		  url: '/admin/fragment_userinfo?username=' + username,
		  type: 'GET',
		  dataType: "text",
		}).done((data, textStatus, jqXHR) => {
			largeDialog.showDialog(data);
		}).fail((jqXHR, textStatus, errorThrown) => {
			//fragment_userinfo_showMessage(jqXHR.responseText);
		});	
	}
</script>