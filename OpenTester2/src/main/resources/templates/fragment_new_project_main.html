<div id="headerpane"></div>
<div id="flex">

	<div id="treepane" class="border border-secondary">treepane</div>
	<div id="rightpane" class="border border-secondary">	
		<div class="btn-group" role="group" aria-label="Basic radio toggle button group">
			<input type="radio" class="btn-check" name="btnradio" id="btnradio1" autocomplete="off" checked onclick="setPresentationType('summary')">
			<label class="btn btn-outline-primary" for="btnradio1">Summary</label>
		
			<input type="radio" class="btn-check" name="btnradio" id="btnradio2" autocomplete="off" onclick="setPresentationType('detail')">
			<label class="btn btn-outline-primary" for="btnradio2">Detail</label>	
		</div>
		<div id="mainpane"></div>
	</div>
</div>

<script type="text/javascript" th:inline="javascript">
	$(function() {
		$.ajax({
			url: '/admin/fragment_new_project_header',
			type: 'GET',
			dataType: "text",
		}).done((data, textStatus, jqXHR) => {
			$('#headerpane').empty();
			$('#headerpane').append(data);
		}).fail((jqXHR, textStatus, errorThrown) => {
			console.log(errorThrown);
		});	
		
		$.ajax({
			url: '/admin/fragment_new_project_tree',
			type: 'GET',
			dataType: "text",
		}).done((data, textStatus, jqXHR) => {
			$('#treepane').empty();
			$('#treepane').append(data);
		}).fail((jqXHR, textStatus, errorThrown) => {
			console.log(errorThrown);
		});	
		
		Split(['#treepane', '#rightpane'], {
		 sizes: [25, 75],
		 gutterSize: 10,
		})
	});
	
	var treeListener = [];	
	function addTreeListener(listener) {
		treeListener.push(listener);
	}
	
	var currentMainPage = null;
	function changeProjectMainPane(url) {
		currentMainPage = url;
		for (var onChange of treeListener) {
			onChange(url);
		}
		$.ajax({
			url: url.replace("{pt}", getPresentationType()),
			type: 'GET',
			dataType: "text",
		}).done((data, textStatus, jqXHR) => {
			$('#mainpane').empty();
			$('#mainpane').append(data);
		}).fail((jqXHR, textStatus, errorThrown) => {
			console.log(errorThrown);
		});			
	}
	
	var presentationType = 'summary';
		
	function getPresentationType() {
		return presentationType;
	}
	
	function setPresentationType(p) {
		presentationType = p;
		if (currentMainPage != null) {
			changeProjectMainPane(currentMainPage);
		}
	}
	
	function updateProjectUI() {
		changeProjectMainPane(currentMainPage);
		updateTree();
	}
	
	var copied_type;
	var copied_parentid;
	function copy_node(type, parentid) {
debugger;
		copied_type = type;
		copied_parentid = parentid;
	}
	function paste_node(type, parentid) {
debugger;
		$.ajax({
			url: '/admin/copyNode/' + type + '/' + copied_parentid + '/' + parentid,
			type: 'GET',
			dataType: "text",
		}).done((data, textStatus, jqXHR) => {
			updateTree();
		}).fail((jqXHR, textStatus, errorThrown) => {
			console.log(errorThrown);
		});				
	}	
</script>