<div id="headerpane"></div>
<div id="flex">
	<div id="treepane" class="border border-secondary">treepane</div>
	<div id="rightpane" class="border border-secondary">
		<button onclick="onAddNode()">Add Folder</button>
		<button onclick="onAddTestItem()">Add TestItem</button>
		<div id="mainpane"></div>
	</div>
</div>

<script type="text/javascript" th:inline="javascript">
	$(function() {
		$.ajax({
			url: '/admin/2nd/fragment_new_project_header',
			type: 'GET',
			dataType: "text",
		}).done((data, textStatus, jqXHR) => {
			$('#headerpane').empty();
			$('#headerpane').append(data);
		}).fail((jqXHR, textStatus, errorThrown) => {
			console.log(errorThrown);
		});	
		
		$.ajax({
			url: '/admin/2nd/fragment_new_project_tree',
			type: 'GET',
			dataType: "text",
		}).done((data, textStatus, jqXHR) => {
			$('#treepane').empty();
			$('#treepane').append(data);
		}).fail((jqXHR, textStatus, errorThrown) => {
			console.log(errorThrown);
		});	
		
		Split(['#treepane', '#rightpane'], {
		 sizes: [25, 75],
		 gutterSize: 10,
		})
	});
	

	if (typeof projectMain !==' function'){ window.projectMain = new class{
		listeners = [];
		
		nodeListener(listener) {
			this.listeners.push(listener);
		}
		
		nodeChanged(type, id) {
			this.listeners.forEach((listener) => listener(type, id));
			this.type = type;
			this.id = id;
			
			const url = "/admin/2nd/nodeListHtml/" + this.id;
			$.ajax({
				url: url,
				type: 'GET',
				dataType: "text",
			}).done((data, textStatus, jqXHR) => {
				$('#mainpane').empty();
				$('#mainpane').append(data);
			}).fail((jqXHR, textStatus, errorThrown) => {
				console.log(errorThrown);
			});	
		}
				
	}}

//	class ProjectMain {
//	};
	
//	if(typeof projectMain !==' function'){ window.projectMain = new ProjectMain()}
	
//	const projectMain = new ProjectMain();
	
	function onAddNode() {
debugger;
		var obj = new Object();
		obj.name = "Node";
		obj.parentId = projectMain.id;
		$.ajax({
			url: '/admin/2nd/node',
			type: 'POST',
			data: JSON.stringify(obj),
			contentType: 'application/json',
			dataType: 'text'
		}).done((data, textStatus, jqXHR) => {
			debugger;
			updateProjectUI();
		}).fail((jqXHR, textStatus, errorThrown) => {
		});		
	}
	
	function onAddTestItem() {
		
	}
</script>