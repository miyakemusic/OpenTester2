<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    
	<link rel="stylesheet" th:href="@{/webjars/bootstrap/css/bootstrap.min.css}">
	<link rel="stylesheet" th:href="@{/webjars/jstree/themes/default/style.min.css}"> 
	<link rel="stylesheet" type="text/css" th:href="@{/css/opentester.css}" />
<!--	<link rel="stylesheet" th:href="@{/webjars/flatpickr/dist/plugins/monthSelect/style.css}"> -->
	<link rel="stylesheet" th:href="@{/webjars/flatpickr/dist/flatpickr.min.css}">

	<script th:src="@{/webjars/jquery/jquery.min.js}"></script>
	<script th:src="@{/webjars/bootstrap/js/bootstrap.min.js}"></script>
	<script th:src="@{/webjars/chartjs/dist/chart.min.js}"></script>
	<script th:src="@{/webjars/chartjs-plugin-datalabels/dist/chartjs-plugin-datalabels.min.js}"></script> 
	<script th:src="@{/webjars/jstree/jstree.min.js}"></script> 
	<script th:src="@{/webjars/flatpickr/dist/flatpickr.min.js}" defer></script>
	<script th:src="@{/webjars/flatpickr/dist/l10n/ja.js}" defer></script>
<!--	<script th:src="@{/webjars/flatpickr/dist/plugins/monthSelect/index.js}" defer></script> -->

	<script th:src="@{/js/auth.js}"></script> 
	<script th:src="@{/js/progressbar.js}"></script> 
	<script>
		class PageController {
			mainPage(url, id) {
				$('#index_content').empty();
				$.ajax({
				  url: url,
				  type: 'GET',
				  dataType: "text",
				}).done((data, textStatus, jqXHR) => {
					$('#index_content').append(data);
					$('#' + id).addClass('active');
					$('#' + id).attr('aria-selected', false);
					
				}).fail((jqXHR, textStatus, errorThrown) => {
					console.log(errorThrown);
				});				
			}
			
			fullWidth(full) {
				if (full) {
					$('#index_maindiv').removeClass();
					$('#index_rightdiv').removeClass();
					$('#index_maindiv').addClass("col-12");
					$('#index_rightdiv').addClass("col-0");		
					$('#index_rightdiv').empty();		
				}
				else {
					$('#index_maindiv').removeClass();
					$('#index_rightdiv').removeClass();
					$('#index_maindiv').addClass("col-9");
					$('#index_rightdiv').addClass("col-3");					
				}
			}
			
			loginPage() {
				auth.getLoginPage('fragment_auth_logindiv');
				this.fullWidth(false);
				signinFragment();
				
				function signinFragment() {
					$('#index_rightdiv').empty();
					$.ajax({
					  url: '/fragment_signin',
					  type: 'GET',
					  dataType: "text",
					}).done((data, textStatus, jqXHR) => {
						$('#index_rightdiv').append(data);
						
					}).fail((jqXHR, textStatus, errorThrown) => {
						console.log(errorThrown);
					});					
				}
			}
			
			updateHeader() {
				$.ajax({
				  url: '/fragment_header',
				  type: 'GET',
				  dataType: "text",
				}).done((data, textStatus, jqXHR) => {
					$('#index_header').empty();
					$('#index_header').append(data);
				}).fail((jqXHR, textStatus, errorThrown) => {
					console.log(errorThrown);
				});
			}
		}
		
		var pageController = new PageController();
		
		$(function() {
			auth.callback(function(status) {
				if (status == 'loggedIn') {
					pageController.fullWidth(true);
					pageController.updateHeader();
				}
				else if (status == 'loggedOut') {
					pageController.fullWidth(false);
					
					initScreen();
					pageController.updateHeader();
				}
				else if (status == 'userListChanged') {
				//	userList();
				}
			});
			auth.initAuth();
			pageController.updateHeader();
			
			function initScreen() {
				$('#index_content').empty();				
			}
		});
		
		function getNewUserFragment() {
			$.ajax({
			  url: '/admin/fragment_newuser',
			  type: 'GET',
			  //contentType: 'text/html',
			  dataType: "text",
			}).done((data, textStatus, jqXHR) => {
//				$('#index_newuser').empty();
				$('#index_content').append(data);
			}).fail((jqXHR, textStatus, errorThrown) => {
				console.log(errorThrown);
			});					
		}
	</script>

    <title>OpenTester Top</title>
</head>
<body style="padding-top:5rem">   
	<div th:insert="~{fragment_dialog}"></div>
	<div id="index_header"></div> 
	<div class="container-fluid">
		<div class="row">
			<div id="index_maindiv" class="col-9">
				<div id="index_content"></div>	
			</div>
			<div id="index_rightdiv" class="col-3">
<!--				<div th:insert="~{fragment_auth}" ></div> -->
			</div>
		</div>
	</div>
</body>
</html>