<div th:insert="~{fragment_projectheader}"></div>
<label>
	<div><label th:text="#{label.project.dut}"></label>:<label th:text="${dut}"></label></div>
	<div><label th:text="#{label.project.criteria}"></label>:<label th:text="${criteria}"></label>[<label th:text="${unit}"></label>]</div>
	<div><label th:text="#{label.project.result}"></label>:<label th:text="${result}"></label>[<label th:text="${unit}"></label>]</div>
	<div><label th:text="#{label.project.status}"></label>:<label th:text="${status}"></label></div>
	<div><label th:text="#{label.project.history}"></label>:<label th:text="${history}"></label></div>
	<div><label th:text="#{label.project.rawdata}"></label><button id="download" class="btn btn-link" th:text="${rawDataName}"></button></div>
	<div><a th:href="${rawDataUrl}" th:text="${rawDataName}"></a></div>
	<div><label th:text="#{label.project.image}"></label><img id="imageid"></div>
</div>
<script type="text/javascript" th:inline="javascript">
	$(function() {
		var url = /*[[${imageUrl}]]*/;
		$.ajax({
			type: "GET",
			url: url,
			dataType : "text"
		})
		.done(function(data){ 
			var img = document.getElementById("imageid");
			img.src = "data:image/png;base64," + data;

		})
		.fail(function(XMLHttpRequest, textStatus, errorThrown){
			alert(errorThrown);
		});			
		
		$('#download').click(function(){
			var url = /*[[${rawDataUrl}]]*/;
			$.ajax({
				type: "GET",
				url: url,
    			dataType: 'text',
 //   			responseType:'arraybuffer',
			})
			.done(function(base64){ 
				debugger;
					var bin = atob(base64).replace(/^.*,/, '');
					var buffer = new Uint8Array(bin.length);
				    for (var i = 0; i < bin.length; i++) {
				        buffer[i] = bin.charCodeAt(i);
				    }
                    //Convert the Byte Data to BLOB object.
                    var blob = new Blob([buffer.buffer], { type: "octet/stream" });
//                    var blob = new Blob([data], { type: "image/png" });
                    len = blob.lenth;
 					var fileName = /*[[${rawDataName}]]*/;
                    //Check the Browser type and download the File.
                    var isIE = false || !!document.documentMode;
                    if (isIE) {
                        window.navigator.msSaveBlob(blob, fileName);
                    } else {
                        var url = window.URL || window.webkitURL;
                        link = url.createObjectURL(blob);
                        var a = $("<a />");
                        a.attr("download", fileName);
                        a.attr("href", link);
                        $("body").append(a);
                        a[0].click();
                        $("body").remove(a);
                    }	
			})
			.fail(function(XMLHttpRequest, textStatus, errorThrown){
				alert(errorThrown);
			});			
		});
	});
</script>