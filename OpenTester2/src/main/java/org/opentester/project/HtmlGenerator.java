package org.opentester.project;

import java.lang.reflect.Field;
import java.lang.reflect.InvocationTargetException;
import java.lang.reflect.Method;
import java.util.List;

import org.springframework.util.StringUtils;

public class HtmlGenerator<T> {
	public String createDialog(T object) throws NoSuchMethodException, SecurityException, IllegalAccessException, InvocationTargetException {
		StringBuilder str = new StringBuilder();
		str.append("<div>");
		
		for (int i = 0; i < object.getClass().getDeclaredFields().length; i++) {
			Field field = object.getClass().getDeclaredFields()[i];
			if (field.getType().equals(String.class)) {
				String name = field.getName();
				Method method = object.getClass().getDeclaredMethod("get" + StringUtils.capitalize(name));
				Object value = method.invoke(object);

				String inputID = "Input" + i;
				
				str.append("<div>");
				str.append("<label for=\"" + inputID + "\">" + StringUtils.capitalize(name) + "</label>");
				str.append("<input type=\"text\" id=\"" + inputID + "\" name=\"" + inputID + "\" value=\"" + value +  "\" class=\"form-control\" />");
				str.append("</div>");
			}
		}
		str.append("</div>");
		return str.toString();		
	}
	
	public String createTable(List<T> list, String url)
			throws NoSuchMethodException, IllegalAccessException, InvocationTargetException {
		
		Field[] fields = list.get(0).getClass().getDeclaredFields();
		
		StringBuilder str = new StringBuilder();
		str.append("<div><table class=\"table table-striped\">");
		
		str.append("<thead><tr>");
		for (int i = 0; i < fields.length; i++) {
			str.append("<th>" + StringUtils.capitalize(fields[i].getName()) +  "</th>");
		}
		
		str.append("<th></th></tr></thead><tbody>");
		String id = "";
		for (Object object : list) {
			str.append("<tr>");
		
			
			for (int i = 0; i < fields.length; i++) {
				Field field = fields[i];
				String name = field.getName();
				Method method = object.getClass().getDeclaredMethod("get" + StringUtils.capitalize(name));
				Object value = method.invoke(object);				
				str.append("<td>" + value +  "</td>");
				
				if (i == 0) {
					id = value.toString();
				}
			}
			
			String button = "<td><button class=\"btn btn-secondary\" onclick=\"on_edit_table(" + id + ")\">Edit</button></td>";
			str.append(button);
			
			str.append("</tr>");
		}
		str.append("</tbody></table></div>");
		
//		String url2 = "'" + url + id + "'";
		
		String js = "<script type=\"text/javascript\" inline=\"javascript\">\n" +
		"$(function() {\n" + 
			"dialogCallback(function() {\n" +
			"});\n"+
		"});\n" +
		
		"function on_edit_table(id) {\n" +
			"debugger;\n" +
			"$.ajax({\n" +
			  "url: '" + url + "'+id,\n" + 
			  "type: 'GET',\n" +
			  "dataType: 'html', \n"+
			"}).done((data, textStatus, jqXHR) => {\n" +
				"$('#dialog_content').empty();" +
				"$('#dialog_content').append(data);" +
				"showDialog();"+
			"}).fail((jqXHR, textStatus, errorThrown) => {\n"+
			    
			"});\n"+
		"}\n"+
		"</script>";
		
		
		return str.toString() + js;
	}
}
