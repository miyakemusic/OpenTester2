<button class="btn btn-link" onclick="onEditNode()">Edit</button>
<button class="btn btn-link" onclick="onNewNode()">New Folder</button>
<button class="btn btn-link" onclick="onDelete()">Delete</button>
<button class="btn btn-link" onclick="onAddTestItem()">New Test Item</button>
<table id="nodeListTable">
	<thead>
		<tr>
			<th>ID</th>
			<th>Name</th>
		</tr>
	</thead>
</table>
<script type="text/javascript" inline="javascript">
$(function() {
	$('#nodeListTable').DataTable( {
		autoWidth: false,
		pagingType: 'simple_numbers',
		ajax: {
			url: '/*[[${getNodeUrl}]]*/',
			dataSrc: ''
			},
		columns: [
			{ data: 'id' },
			{ data: 'name' },
		]
	} );	
});
function onDelete() {
	smallDialog.callback(function(){
		$.ajax({
			url: '/*[[${delNodeUrl}]]*/',
			type: 'DELETE',
			dataType: 'text'
		}).done((data, textStatus, jqXHR) => {
			smallDialog.hideDialog();
			projectMain.structureChanged();
		}).fail((jqXHR, textStatus, errorThrown) => {
		});		
	});
	smallDialog.showDialog("<label>Delete?</label>");
}

function onNewNode() {
	largeDialog.callback(function(){
		var obj = new Object();
		/*[[${newNodeObjectImpl}]]*/
		postObject('/*[[${postNodeUrl}]]*/', obj);
	});
	largeDialog.showDialog('/*[[${newNodeContentHtml}]]*/');	
}

function onEditNode() {
	largeDialog.callback(function(){
		var obj = new Object();
		/*[[${editNodeObjectImpl}]]*/
		postObject('/*[[${postNodeUrl}]]*/', obj);
	});
	largeDialog.showDialog('/*[[${editNodeContentHtml}]]*/');	
}

function postObject(url, obj) {
	$.ajax({
		url: url,
		type: 'POST',
		data: JSON.stringify(obj),
		contentType: 'application/json',
		dataType: 'text'
	}).done((data, textStatus, jqXHR) => {
		largeDialog.hideDialog();
		projectMain.structureChanged();
	}).fail((jqXHR, textStatus, errorThrown) => {
	});			
}

function onAddTestItem() {
	/*[[${getOptions}]]*/
	largeDialog.callback(function(){
		var obj = new Object();
		/*[[${newTestItemObjectImpl}]]*/
		postObject('/*[[${posturl}]]*/', obj);
	});
	largeDialog.showDialog('/*[[${newTestItemContentHtml}]]*/');
}

function showSelectDialog(url) {
	smallDialog.callback(function(){
		var data = table.rows().data();
		var selectedRows = table.rows({ selected: true });
		debugger;
		for (var d of table.rows().data().toArray()) {
			
		}
		smallDialog.hideDialog();
	});
	smallDialog.showDialog("<table id='selectTable'><thead><tr><th></th><th>Primary</th><th>Secondary</th><th>Tertiary</th></tr></thead></table>");
	var table = $('#selectTable').DataTable( {
		autoWidth: false,
		columnDefs: [
			{
				orderable: false,
				render: DataTable.render.select(),
				targets: 0
			}
		],
		pagingType: 'simple_numbers',
		ajax: {
			url: url,
			dataSrc: ''
		},
		columns: [
			{ data: null },
//			{ data: 'id' },
			{ data: 'primary' },
			{ data: 'secondary' },
			{ data: 'tertiary' },
		],
		select: {
			style: 'os',
			selector: 'td:first-child'
		}
	} );
}

// Not Used
function getOptions(url, id) {
	$.ajax({
		url: url,
		type: 'GET',
		dataType: 'json'
	}).done((data, textStatus, jqXHR) => {
		for (var d of data) {
			$('#' + id).append($('<option>').html(d.text).val(d.id));
		}
	}).fail((jqXHR, textStatus, errorThrown) => {
	});	
}
</script>