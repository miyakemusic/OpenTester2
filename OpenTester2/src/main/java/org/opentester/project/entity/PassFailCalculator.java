package org.opentester.project.entity;

import javax.script.ScriptEngine;
import javax.script.ScriptEngineManager;
import javax.script.ScriptException;

import org.graalvm.polyglot.Context;
import org.graalvm.polyglot.Value;

public class PassFailCalculator {
	public enum PassFailEnum {
		Untouched,
		Passed,
		Failed, 
		Tested,
	}
	
	private static ScriptEngine scriptEngine = new ScriptEngineManager().getEngineByName("js");

	
	private PassFailCalculator() {}

	public static synchronized PassFailEnum judgePassFail(String criteria, String result) {
    	PassFailEnum passFail = PassFailEnum.Untouched;
    	if (criteria != null && !criteria.isEmpty()) {
    		if (result != null && !result.isEmpty()) {
	    		
	    		try {
					Boolean ret = (Boolean)scriptEngine.eval(criteria.replace("x", result));
					passFail = ret ? PassFailEnum.Passed: PassFailEnum.Failed;
				} catch (ScriptException e) {
					e.printStackTrace();
				}	
    		}
    		else {
    			passFail = PassFailEnum.Untouched;
    		}
    	}
    	else {
    		if (result != null && !result.isEmpty()) {
    			passFail = PassFailEnum.Tested;
    		}
    		else {
    			passFail = PassFailEnum.Untouched;
    		}
    	}
    	
    	return passFail;
	}
}
