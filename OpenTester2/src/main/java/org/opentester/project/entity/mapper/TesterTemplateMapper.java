package org.opentester.project.entity.mapper;

import java.util.stream.Collectors;

import org.opentester.project.dto.KeyValueDto;
import org.opentester.project.dto.TesterTemplateDto;
import org.opentester.project.entity.TesterTemplateEntity;
import org.opentester.project.repository.TestItemTemplateRepository;
import org.opentester.project.repository.TesterSupplierRepository;
import org.springframework.beans.factory.annotation.Autowired;

public class TesterTemplateMapper extends DtoMapper<TesterTemplateEntity, TesterTemplateDto>{

	@Autowired
	private TesterSupplierRepository projectTesterSupplierRepository;
	
	@Autowired
	private TestItemTemplateRepository projectTestItemTemplateRepository;
	
	@Override
	public TesterTemplateDto toDto(TesterTemplateEntity e) {
		return TesterTemplateDto.builder()
				.id(e.getId())
				.keyword(e.getKeyword())
				.url(e.getUrl())
				.model(e.getModel())
				.name(e.getName())
				.supplier(isNotNull(e.getSupplier()) ? KeyValueDto.builder().key(e.getSupplier().getId()).value(e.getSupplier().toString()).build() : null)
				.testItemTemplates(isNotNull(e.getTestItemTemplates()) ? e.getTestItemTemplates().stream().map(s -> KeyValueDto.builder().key(s.getId()).value(s.toString()).build()).collect(Collectors.toList()) : null)
				.build();
	}

	@Override
	public TesterTemplateEntity toEntity(TesterTemplateDto d) {
		return TesterTemplateEntity.builder()
				.id(d.getId())
				.url(d.getUrl())
				.keyword(d.getKeyword())
				.model(d.getModel())
				.name(d.getName())
				.supplier(isNotNull(d.getSupplier()) ? projectTesterSupplierRepository.findById(d.getSupplier().getKey()).get() : null)
				.testItemTemplates(isNotNull(d.getTestItemTemplates()) ? d.getTestItemTemplates().stream().map(sr -> projectTestItemTemplateRepository.findById(sr.getKey()).get()).collect(Collectors.toList()): null)
				.build();
	}

}
