package org.opentester.project.entity.mapper;

import org.opentester.project.dto.KeyValueDto;
import org.opentester.project.dto.CriteriaTemplateDto;
import org.opentester.project.entity.CriteriaTemplateEntity;
import org.opentester.project.repository.TestItemTemplateRepository;
import org.springframework.beans.factory.annotation.Autowired;

public class CriteriaTemplateMapper extends DtoMapper<CriteriaTemplateEntity, CriteriaTemplateDto> {

	@Override
	public CriteriaTemplateDto toDto(CriteriaTemplateEntity e) {
		return CriteriaTemplateDto.builder()
				.id(e.getId())
				.description(e.getDescription())
				.criteriaFormula(e.getCriteriaFormula())
				.testItemTemplate(isNotNull(e.getTestItemTemplate()) ? KeyValueDto.builder().key(e.getTestItemTemplate().getId()).value(e.getTestItemTemplate().toString()).build() : null)
				.build();
	}

	@Autowired
	private TestItemTemplateRepository projectTestItemTemplateRepository;
	
	@Override
	public CriteriaTemplateEntity toEntity(CriteriaTemplateDto d) {
		return CriteriaTemplateEntity.builder()
				.id(d.getId())
				.description(d.getDescription())
				.criteriaFormula(d.getCriteriaFormula())
				.testItemTemplate(isNotNull(d.getTestItemTemplate()) ? projectTestItemTemplateRepository.findById(d.getTestItemTemplate().getKey()).get() : null)
				.build();
	}

}
