package org.opentester.project.entity.mapper;

import java.util.stream.Collectors;

import org.opentester.project.dto.KeyValueDto;
import org.opentester.project.dto.ProjectRawDataDto;
import org.opentester.project.entity.ProjectRawDataEntity;
import org.opentester.project.repository.ProjectTestResultRepository;
import org.springframework.beans.factory.annotation.Autowired;

public class ProjectRawDataMapper extends DtoMapper<ProjectRawDataEntity, ProjectRawDataDto> {

	@Override
	public ProjectRawDataDto toDto(ProjectRawDataEntity e) {
		return ProjectRawDataDto.builder()
				.id(e.getId())
				.name(e.getName())
				.results(isNotNull(e.getResults()) ? e.getResults().stream().map(r -> KeyValueDto.builder().key(r.getId()).value(r.toString()).build()).collect(Collectors.toList()): null)
				.build();
	}

	@Autowired
	private ProjectTestResultRepository projectTestResultRepository;
	
	@Override
	public ProjectRawDataEntity toEntity(ProjectRawDataDto d) {
		return ProjectRawDataEntity.builder()
				.id(d.getId())
				.name(d.getName())
				.results(isNotNull(d.getResults())? projectTestResultRepository.findAllById(d.getResults().stream().map(r -> r.getKey()).collect(Collectors.toList())): null)
				.build();
	}

}
