package org.opentester.project.entity.mapper;

import org.opentester.project.dto.ProjectDutDto;
import org.opentester.project.dto.DutPackageDto;
import org.opentester.project.dto.KeyValueDto;
import org.opentester.project.entity.ProjectDutEntity;
import org.opentester.project.entity.ProjectDutPackageEntity;
import org.opentester.project.repository.DutPackageRepository;
import org.springframework.beans.factory.annotation.Autowired;

public class ProjectDutMapper extends DtoMapper <ProjectDutEntity, ProjectDutDto>{

	@Autowired
	private DutPackageRepository projectDutPackageRepository;
	
	@Override
	public ProjectDutDto toDto(ProjectDutEntity e) {
		return ProjectDutDto.builder()
			.id(e.getId())
			.name(e.getName())
			.completeDate(isNotNull(e.completeDate()) ? e.completeDate().toGMTString(): null)
			.location(e.allLocations().toString())
			.dutPackage(isNotNull(e.getDutpackage()) ? KeyValueDto.builder().key(e.getDutpackage().getId()).value(e.toString()).build() : null)
			.build();
	}

	@Override
	public ProjectDutEntity toEntity(ProjectDutDto d) {
		return ProjectDutEntity.builder()	
				.id(d.getId())
				.name(d.getName())
				.dutpackage(isNotNull(d.getDutPackage()) ? projectDutPackageRepository.findById(d.getDutPackage().getKey()).get()  : null)
				.build();
	}

}
