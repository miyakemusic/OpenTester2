package org.opentester.project.entity.mapper;

import java.util.stream.Collectors;

import org.opentester.project.dto.KeyValueDto;
import org.opentester.project.dto.RawDataDto;
import org.opentester.project.entity.RawDataEntity;
import org.opentester.project.repository.TestResultRepository;
import org.springframework.beans.factory.annotation.Autowired;

public class RawDataMapper extends DtoMapper<RawDataEntity, RawDataDto> {

	@Override
	public RawDataDto toDto(RawDataEntity e) {
		return RawDataDto.builder()
				.id(e.getId())
				.name(e.getName())
				.results(isNotNull(e.getResults()) ? e.getResults().stream().map(r -> KeyValueDto.builder().key(r.getId())
						.value(r.getTestItem().getCriteria().getTestItemTemplate().getTestkey() + "@" + r.getDate()).build()).collect(Collectors.toList()): null)
				.build();
	}

	@Autowired
	private TestResultRepository projectTestResultRepository;
	
	@Override
	public RawDataEntity toEntity(RawDataDto d) {
		return RawDataEntity.builder()
				.id(d.getId())
				.name(d.getName())
				.results(isNotNull(d.getResults())? projectTestResultRepository.findAllById(d.getResults().stream().map(r -> r.getKey()).collect(Collectors.toList())): null)
				.build();
	}

}
