package org.opentester.project.entity.mapper;

import org.opentester.project.dto.KeyValueDto;
import org.opentester.project.dto.TestPointDto;
import org.opentester.project.entity.ProjectTestPointEntity;
import org.opentester.project.repository.ProjectDutRepository;
import org.opentester.project.repository.ProjectUserRepository;
import org.springframework.beans.factory.annotation.Autowired;

public class ProjectTestPointMapper extends DtoMapper<ProjectTestPointEntity, TestPointDto> {

	@Autowired
	private ProjectUserRepository projectUserRepository;
	
	@Autowired
	private ProjectDutRepository projectDutRepository;
	
	@Override
	public TestPointDto toDto(ProjectTestPointEntity e) {
		return TestPointDto.builder()
				.id(e.getId())
				.name(e.getName())
				.location(e.getLocation())
				.operator(isNotNull(e.getOperator()) ? KeyValueDto.builder().key(e.getOperator().getId()).value(e.getOperator().toString()).build() : null)
				.dut(isNotNull(e.getDut()) ? KeyValueDto.builder().key(e.getDut().getId()).value(e.getDut().toString()).build() : null)
//				.completeDate(e.completeDate().toString())
//				.completeDueDate(e.toString())
				.passed(e.passFail().getPassed())
				.failed(e.passFail().getFailed())
				.untouched(e.passFail().getUntouched())
				.build();
	}

	@Override
	public ProjectTestPointEntity toEntity(TestPointDto d) {
		return ProjectTestPointEntity.builder()
				.id(d.getId())
				.name(d.getName())
				.location(d.getLocation())
				.operator(isNotNull(d.getOperator())? projectUserRepository.findById(d.getOperator().getKey()).get() : null)
				.dut(isNotNull(d.getDut())? projectDutRepository.findById(d.getDut().getKey()).get(): null)
				.build();
	}

}
