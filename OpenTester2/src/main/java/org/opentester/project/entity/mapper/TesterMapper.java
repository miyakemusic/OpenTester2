package org.opentester.project.entity.mapper;

import org.opentester.project.dto.KeyValueDto;
import org.opentester.project.dto.TesterDto;
import org.opentester.project.entity.TesterEntity;
import org.opentester.project.repository.TesterTemplateRepository;
import org.opentester.project.repository.ProjectUserRepository;
import org.springframework.beans.factory.annotation.Autowired;

public class TesterMapper extends DtoMapper <TesterEntity, TesterDto> {

	@Autowired
	private ProjectUserRepository projectUserRepository;
	
	@Autowired
	private TesterTemplateRepository projectTesterTemplateRepository;
	
	@Override
	public TesterDto toDto(TesterEntity e) {
		return TesterDto.builder()
				.id(e.getId())
				.currentUser(isNotNull(e.getCurrentUser()) ? KeyValueDto.builder().key(e.getCurrentUser().getId()).value(e.getCurrentUser().toString()).build() : null)
				.model(isNotNull(e.getTesterTemplate()) ? KeyValueDto.builder().key(e.getTesterTemplate().getId()).value(e.getTesterTemplate().toString()).build() : null)
				.serialNumber(e.getSerialNumber())
				.status(e.getStatus())
				.build();
	}

	@Override
	public TesterEntity toEntity(TesterDto d) {
		return TesterEntity.builder()
				.id(d.getId())
				.currentUser(isNotNull(d.getCurrentUser()) ? projectUserRepository.findById(d.getCurrentUser().getKey()).get() : null)
				.testerTemplate(isNotNull(d.getModel()) ? projectTesterTemplateRepository.findById(d.getModel().getKey()).get() : null)
				.serialNumber(d.getSerialNumber())
				.build();
	}

}
