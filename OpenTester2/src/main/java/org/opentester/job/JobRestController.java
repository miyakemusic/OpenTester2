package org.opentester.job;

import java.security.Principal;
import java.util.List;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.web.bind.annotation.DeleteMapping;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.PathVariable;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RestController;

@RestController
@RequestMapping("/api/jobs")
public class JobRestController {

	@Autowired
	private JobTemplateRepository jobTemplateRepository;
	
	@Autowired 
	private JobItemRepository jobItemRepository;
	
	@Autowired
	private CriteriaRepository criteriaRepository;
	
	@GetMapping("/admin/test")
	public JobTemplateEntity createTestJobs(Principal princiapl) {
		JobTemplateEntity jobTemplate = new JobTemplateEntity();
		jobTemplate.setJob_name("Tokyo_Jujo_Oji_#0001");
		jobTemplate = this.jobTemplateRepository.save(jobTemplate);
//		jobTemplate.getTest_items().add(jobItem);
				
		JobItemEntity jobItem = new JobItemEntity();
		jobItem.setJob_status(JobStatusEnum.UNTOUCHED);
		jobItem.setJob_type(JobTypeEnum.INSTALLATION);
		jobItem.setTemplate(jobTemplate);
		
		CriteriaEntity criteria = new CriteriaEntity();
		criteria.setCriteria_script("VALUE>=10.00");
//		criteria = this.criteriaRepository.save(criteria);
		
//		jobItem.setCriteria(criteria);

		this.jobItemRepository.save(jobItem);
		
//		jobTemplate = this.jobTemplateRepository.save(jobTemplate);
		
		return jobTemplate;
	}
	
	@DeleteMapping("/admin/job/{id}")
	public String deleteJob(@PathVariable String id) {
		this.jobTemplateRepository.deleteById(Long.valueOf(id));
		return "OK";
	}
	
}
